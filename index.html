<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>📺 جلب التاغات من فيديو يوتيوب</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white shadow-xl rounded-xl p-6 w-full max-w-2xl space-y-4 text-center">
    <h1 class="text-2xl font-bold text-blue-700">📺 أداة استخراج التاغات من يوتيوب</h1>

    <input id="videoUrl" type="text" placeholder="ألصق رابط فيديو يوتيوب هنا"
      class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-400 outline-none text-right" />

    <button onclick="fetchTags()"
      class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
      🎯 جلب التاغات
    </button>

    <div id="tagsContainer" class="flex flex-wrap gap-2 justify-center text-sm text-gray-700 min-h-[2rem]">
      <!-- التاغات تظهر هنا -->
    </div>

    <div class="flex justify-center gap-4">
      <button id="copyBtn" onclick="copyTags()" disabled
        class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200 disabled:opacity-50">
        📋 نسخ التاغات
      </button>

      <button id="downloadBtn" onclick="downloadTags()" disabled
        class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition duration-200 disabled:opacity-50">
        📄 تحميل التاغات كـ .txt
      </button>
    </div>
  </div>

  <script>
    const apiKey = "AIzaSyDMWWYjIpIYo6nCHTZjG_53wHJHBBO__2s"; // ← عوّضها بمفتاحك من YouTube Data API v3
    let lastTags = "";
    let videoTitle = "youtube-tags";

    function extractVideoId(url) {
      try {
        let videoId = null;
        const parsedUrl = new URL(url);
        const hostname = parsedUrl.hostname;

        if (hostname.includes("youtu.be")) {
          videoId = parsedUrl.pathname.slice(1);
        } else if (parsedUrl.pathname.includes("/watch")) {
          videoId = parsedUrl.searchParams.get("v");
        } else if (parsedUrl.pathname.includes("/shorts/")) {
          videoId = parsedUrl.pathname.split("/shorts/")[1].split("?")[0];
        } else if (parsedUrl.pathname.includes("/embed/")) {
          videoId = parsedUrl.pathname.split("/embed/")[1];
        }

        return videoId && videoId.length === 11 ? videoId : null;
      } catch (e) {
        return null;
      }
    }

    async function fetchTags() {
      const url = document.getElementById("videoUrl").value;
      const videoId = extractVideoId(url);
      const container = document.getElementById("tagsContainer");
      const copyBtn = document.getElementById("copyBtn");
      const downloadBtn = document.getElementById("downloadBtn");

      container.innerHTML = '<p class="text-gray-500">⏳ جاري جلب التاغات...</p>';
      copyBtn.disabled = true;
      downloadBtn.disabled = true;

      if (!videoId) {
        container.innerHTML = '<p class="text-red-500">❌ رابط غير صحيح أو غير مدعوم</p>';
        return;
      }

      const apiUrl = `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${apiKey}`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        const snippet = data.items[0]?.snippet;
        const tags = snippet?.tags;
        videoTitle = snippet?.title || "youtube-tags";

        if (tags && tags.length) {
          lastTags = tags.join(", ");
          container.innerHTML = tags.map(tag => `<span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full">${tag}</span>`).join('');
          copyBtn.disabled = false;
          downloadBtn.disabled = false;
        } else {
          container.innerHTML = '<p class="text-yellow-600">⚠️ لا توجد تاغات متاحة لهذا الفيديو</p>';
        }
      } catch (err) {
        container.innerHTML = '<p class="text-red-600">🚫 وقع خطأ أثناء جلب البيانات</p>';
        console.error(err);
      }
    }

    function sanitizeFilename(name) {
      return name.replace(/[\\\/:*?"<>|]/g, "").trim().slice(0, 100);
    }

    function copyTags() {
      navigator.clipboard.writeText(lastTags).then(() => {
        alert("✅ تم نسخ التاغات!");
      }).catch(() => {
        alert("❌ وقع خطأ أثناء النسخ");
      });
    }

    function downloadTags() {
      const filename = sanitizeFilename(videoTitle) + ".txt";
      const blob = new Blob([lastTags], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();

      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
